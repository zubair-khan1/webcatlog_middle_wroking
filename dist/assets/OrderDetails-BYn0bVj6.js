import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a as i,L as q,a0 as Y,x as u,ax as U,aB as V,P as B,B as K,aw as Q,ah as W,ad as b,h as A,U as D,v as J,q as X,aN as Z}from"./vendor-icons-BBHJ0ezg.js";import{b as ee,B as g,s as d}from"./index-76QHltB_.js";import{e as se,u as te,L as H}from"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const de=()=>{var C;const{id:n}=se(),o=te(),{user:a}=ee(),[s,j]=i.useState(null),[N,O]=i.useState([]),[h,P]=i.useState([]),[x,y]=i.useState(""),[R,v]=i.useState(!0),[_,w]=i.useState(!1),[M,E]=i.useState(null),[F,k]=i.useState(!1);i.useEffect(()=>{(async()=>{if(!(!n||!a))try{const{data:r,error:l}=await d.from("orders").select(`
            id,
            order_number,
            status,
            price_amount,
            commission_rate,
            created_at,
            buyer_id,
            seller_id,
            listing:listings(
              id,
              title,
              image_url,
              description,
              preview_url
            ),
            seller:profiles!orders_seller_id_fkey(id, full_name, avatar_url),
            order_access(id, source_files_url, download_count, max_downloads)
          `).eq("id",n).single();if(l)throw l;const G=r.buyer_id===a.id||r.seller_id===a.id,{data:f}=await d.from("profiles").select("role").eq("id",a.id).single(),T=(f==null?void 0:f.role)==="admin";if(!G&&!T){k(!1),j(r),v(!1);return}if(k(!0),j(r),["paid","delivered","completed"].includes(r.status)){z();const m=Array.isArray(r.listing)?r.listing[0]:r.listing;if(m!=null&&m.id){const{data:L}=await d.from("kit_resources").select("id, file_name, file_type, file_url, file_size_bytes, description, linked_deliverable").eq("listing_id",m.id);L&&P(L)}}}catch(r){console.error("Error fetching order:",r),E(r.message||"Failed to load order")}finally{v(!1)}})()},[n,a]);const z=async()=>{if(!n)return;const{data:t,error:r}=await d.from("messages").select(`
        id,
        sender_id,
        content,
        created_at,
        sender:profiles!messages_sender_id_fkey(full_name, avatar_url)
      `).eq("order_id",n).order("created_at",{ascending:!0});!r&&t&&O(t)},$=async t=>{if(t.preventDefault(),!(!x.trim()||!n||!a||!s)){w(!0);try{const r=a.id===s.buyer_id?s.seller_id:s.buyer_id,{error:l}=await d.from("messages").insert({order_id:n,sender_id:a.id,receiver_id:r,content:x.trim()});if(l)throw l;y(""),z()}catch(r){console.error("Error sending message:",r),alert(r.message||"Failed to send message")}finally{w(!1)}}},I=async()=>{var r,l;if(!((l=(r=s==null?void 0:s.order_access)==null?void 0:r[0])!=null&&l.source_files_url))return;const t=s.order_access[0];await d.from("order_access").update({download_count:t.download_count+1}).eq("id",t.id),window.open(t.source_files_url,"_blank"),window.location.reload()};if(R)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(q,{className:"animate-spin text-accent-primary",size:32})});if(M||!s)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4",children:[e.jsx("p",{className:"text-red-400",children:M||"Order not found"}),e.jsx(g,{onClick:()=>o("/dashboard"),children:"Go to Dashboard"})]});if(!F)return e.jsx("div",{className:"min-h-screen bg-background py-12 px-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-accent-secondary/10 border border-accent-secondary/20 mb-6",children:e.jsx(Y,{className:"text-accent-secondary",size:40})}),e.jsx("h1",{className:"text-3xl font-display font-bold text-textMain mb-3",children:"Purchase Required"}),e.jsx("p",{className:"text-textMuted text-lg mb-8",children:"You need to purchase this blueprint to access all resources and support."})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-8 mb-8 text-left",children:[e.jsx("h3",{className:"text-lg font-bold text-textMain mb-6 text-center",children:"What You'll Get"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(u,{size:20,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{className:"text-textMuted",children:"Complete source code and project files"})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(u,{size:20,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{className:"text-textMuted",children:"Setup and deployment documentation"})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(u,{size:20,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{className:"text-textMuted",children:"Direct messaging with the creator"})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(u,{size:20,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{className:"text-textMuted",children:"Lifetime access and commercial usage rights"})]})]})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(g,{variant:"outline",onClick:()=>o("/mvp-kits"),children:"Browse More"}),e.jsxs(g,{onClick:()=>o(`/checkout/${s.listing.id}`),children:["Purchase Now - ₹",s.price_amount]})]})]})});const S=(a==null?void 0:a.id)===s.buyer_id,c=(C=s.order_access)==null?void 0:C[0],p=c?c.max_downloads-c.download_count:0;return e.jsx("div",{className:"min-h-screen bg-background py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>o("/dashboard"),className:"flex items-center gap-2 text-textMuted hover:text-textMain transition-colors mb-8",children:[e.jsx(U,{size:16}),"Back to Dashboard"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-surface border border-border rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[s.listing.image_url&&e.jsx("img",{src:s.listing.image_url,alt:s.listing.title,className:"w-24 h-24 rounded-xl object-cover border border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-display font-bold text-textMain mb-1",children:s.listing.title})}),e.jsx("div",{className:"px-3 py-1.5 rounded-full bg-accent-primary/10 border border-accent-primary/20",children:e.jsx("span",{className:"text-sm font-medium text-accent-primary",children:s.status==="paid"&&"Active"})})]}),e.jsxs("p",{className:"text-sm text-textMuted mb-2",children:["Order #",s.order_number]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-textMuted",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(V,{size:14}),new Date(s.created_at).toLocaleDateString()]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["by ",s.seller.full_name]})]})]})]})}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-textMain mb-6 flex items-center gap-2",children:[e.jsx(B,{size:20}),"Your Resources"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-textMain uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(K,{size:16}),"Getting Started"]}),e.jsxs("div",{className:"space-y-2",children:[s.listing.description&&e.jsx("div",{className:"p-4 bg-surfaceHighlight rounded-lg border border-border",children:e.jsx("p",{className:"text-sm text-textMuted whitespace-pre-line",children:s.listing.description})}),s.listing.preview_url&&e.jsxs("a",{href:s.listing.preview_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 bg-surfaceHighlight rounded-lg border border-border hover:border-accent-primary/30 transition-colors text-sm",children:[e.jsx(Q,{size:16,className:"text-accent-primary"}),e.jsx("span",{className:"text-textMain",children:"View Live Preview"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-textMain uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(W,{size:16}),"Code & Assets"]}),e.jsx("div",{className:"space-y-2",children:c!=null&&c.source_files_url?e.jsx("button",{onClick:I,disabled:p<=0,className:"w-full flex items-center justify-between p-4 bg-accent-primary/10 rounded-lg border border-accent-primary/20 hover:bg-accent-primary/20 transition-colors disabled:opacity-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{size:20,className:"text-accent-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-textMain",children:"Download Source Files"}),e.jsxs("p",{className:"text-xs text-textMuted",children:[p," download",p!==1?"s":""," remaining"]})]})]})}):e.jsx("div",{className:"p-4 bg-surfaceHighlight rounded-lg border border-border text-sm text-textMuted",children:"Files will be available soon. Contact the seller for updates."})})]}),h.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-textMain uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(B,{size:16}),"Downloadable Resources (",h.length,")"]}),e.jsx("div",{className:"space-y-2",children:h.map(t=>e.jsxs("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 bg-surfaceHighlight rounded-lg border border-border hover:border-accent-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-accent-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(b,{size:16,className:"text-accent-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-textMain",children:t.file_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-textMuted",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-surface rounded border border-border uppercase font-mono",children:t.file_type}),t.file_size_bytes&&e.jsxs("span",{children:[(t.file_size_bytes/1024/1024).toFixed(2)," MB"]})]}),t.description&&e.jsx("p",{className:"text-xs text-textMuted mt-1",children:t.description})]})]}),e.jsx(b,{size:16,className:"text-accent-primary shrink-0"})]},t.id))})]})]})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-textMain mb-4 flex items-center gap-2",children:[e.jsx(A,{size:20}),"Questions about this blueprint?"]}),e.jsxs("p",{className:"text-sm text-textMuted mb-6",children:["Message ",S?"the creator":"your buyer"," directly for support and clarification."]}),e.jsx("div",{className:"mb-4 max-h-96 overflow-y-auto space-y-3",children:N.length===0?e.jsx("div",{className:"text-center py-8 text-textMuted text-sm",children:"No messages yet. Start the conversation!"}):N.map(t=>{const r=t.sender_id===(a==null?void 0:a.id);return e.jsxs("div",{className:`flex gap-3 ${r?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-surfaceHighlight border border-border flex items-center justify-center shrink-0",children:t.sender.avatar_url?e.jsx("img",{src:t.sender.avatar_url,alt:"",className:"rounded-full"}):e.jsx(D,{size:16,className:"text-textMuted"})}),e.jsxs("div",{className:`flex-1 max-w-md ${r?"text-right":"text-left"}`,children:[e.jsxs("p",{className:"text-xs text-textMuted mb-1",children:[t.sender.full_name," • ",new Date(t.created_at).toLocaleString()]}),e.jsx("div",{className:`inline-block p-3 rounded-lg ${r?"bg-accent-primary/10 text-textMain":"bg-surfaceHighlight text-textMuted"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content})})]})]},t.id)})}),e.jsxs("form",{onSubmit:$,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:t=>y(t.target.value),placeholder:"Type your message...",className:"flex-1 bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain placeholder:text-textMuted/50 focus:outline-none focus:border-accent-primary/50 focus:ring-1 focus:ring-accent-primary/20"}),e.jsx("button",{type:"submit",disabled:!x.trim()||_,className:"px-6 py-3 bg-accent-primary text-accent-primary-fg font-medium rounded-lg hover:brightness-110 transition-all disabled:opacity-50 flex items-center gap-2",children:_?e.jsx(q,{size:18,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(J,{size:18}),"Send"]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6",children:[e.jsx("h3",{className:"text-sm font-bold text-textMuted uppercase tracking-wider mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-textMuted",children:"Blueprint Price"}),e.jsxs("span",{className:"text-textMain font-medium",children:["₹",s.price_amount]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-textMuted",children:"Platform Fee"}),e.jsx("span",{className:"text-textMuted",children:"Included"})]}),e.jsxs("div",{className:"border-t border-border pt-3 flex justify-between",children:[e.jsx("span",{className:"font-bold text-textMain",children:"Total Paid"}),e.jsxs("span",{className:"font-bold text-accent-primary",children:["₹",s.price_amount]})]})]})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6",children:[e.jsx("h3",{className:"text-sm font-bold text-textMuted uppercase tracking-wider mb-4",children:"Creator"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-surfaceHighlight border border-border flex items-center justify-center",children:s.seller.avatar_url?e.jsx("img",{src:s.seller.avatar_url,alt:"",className:"rounded-full"}):e.jsx(D,{size:20,className:"text-textMuted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-textMain",children:s.seller.full_name}),e.jsx("p",{className:"text-xs text-textMuted",children:"Verified Creator"})]})]})]}),e.jsx("div",{className:"bg-surfaceHighlight/50 border border-border rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{size:18,className:"text-accent-primary shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-textMuted",children:[e.jsx("p",{className:"font-semibold text-textMain mb-1",children:"Buyer Protection"}),e.jsx("p",{children:"All purchases are protected by our 7-day money-back guarantee."})]})]})}),e.jsx(H,{to:`/tickets/new?order=${s.id}`,className:"block bg-surface border border-border rounded-2xl p-6 hover:border-accent-primary/30 transition-colors group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(A,{size:18,className:"text-accent-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-textMain mb-1 group-hover:text-accent-primary transition-colors",children:"Need Help?"}),e.jsx("p",{className:"text-xs text-textMuted",children:"Create a support ticket for questions, issues, or refund requests."})]})]})}),S&&e.jsx(H,{to:`/order/${s.id}/refund`,className:"block bg-red-500/5 border border-red-500/20 rounded-2xl p-6 hover:bg-red-500/10 transition-colors group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{size:18,className:"text-red-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-textMain mb-1 group-hover:text-red-400 transition-colors",children:"Request Refund"}),e.jsx("p",{className:"text-xs text-textMuted",children:"Not satisfied? Request a refund within 7 days."})]})]})})]})]})]})})};export{de as default};
