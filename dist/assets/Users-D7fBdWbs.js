import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a,U as L,X as D,aI as F,a_ as O,at as C,a$ as P,q as U,ay as E,aw as _,K as q,x as T,ar as R,J as G,u as B,aH as X,b0 as J}from"./vendor-icons-BBHJ0ezg.js";import{u as K}from"./useAdminUsers-MwbvnzeU.js";import{s as I}from"./index-76QHltB_.js";import"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const V=({isOpen:y,onClose:p,user:l,data:m,onApprove:M,onActionComplete:b,isProcessing:w})=>{var g,f,z,A,H;const[n,j]=a.useState(!1),[c,u]=a.useState("soft"),[d,h]=a.useState(""),[N,o]=a.useState(""),[v,k]=a.useState(7),[S,t]=a.useState(!1);if(!y||!l)return null;const s=m||{},i=w||S,x=async()=>{if(!d.trim()){alert("Please provide a reason for the user.");return}t(!0);try{const{error:r}=await I.rpc("reject_seller_application",{target_user_id:l.id,rejection_type:c,reason_public:d,notes_internal:N,cooldown_days:v});if(r)throw r;b(),p()}catch(r){console.error("Rejection failed:",r),alert(`Failed: ${r.message}`)}finally{t(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:p}),e.jsxs("div",{className:"relative w-full max-w-4xl bg-surface border border-border rounded-xl shadow-2xl max-h-[90vh] flex flex-col animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border bg-surfaceHighlight/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary border border-accent-primary/20",children:l.avatar_url?e.jsx("img",{src:l.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):e.jsx(L,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-display font-bold text-textMain",children:"Review Application"}),e.jsxs("p",{className:"text-sm text-textMuted flex items-center gap-2",children:["Applicant: ",e.jsx("span",{className:"text-textMain font-medium",children:l.full_name})]})]})]}),e.jsx("button",{onClick:p,className:"p-2 hover:bg-surfaceHighlight rounded-lg text-textMuted hover:text-textMain",children:e.jsx(D,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-surfaceHighlight border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-textMuted uppercase mb-2",children:[e.jsx(F,{size:14})," Applicant Type"]}),e.jsx("div",{className:"text-lg font-bold text-textMain capitalize",children:s.applicantType||"Not Specified"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-surfaceHighlight border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-textMuted uppercase mb-2",children:[e.jsx(O,{size:14})," Intent"]}),e.jsx("div",{className:"text-lg font-bold text-textMain capitalize",children:s.applicationIntent||"Not Specified"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-surfaceHighlight border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-textMuted uppercase mb-2",children:[e.jsx(C,{size:14})," Applied At"]}),e.jsx("div",{className:"text-lg font-bold text-textMain",children:l.seller_applied_at?new Date(l.seller_applied_at).toLocaleDateString():"N/A"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-textMain uppercase tracking-wide border-b border-border pb-2 mb-4 flex items-center gap-2",children:[e.jsx(P,{size:16,className:"text-accent-primary"})," Project Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Product Type"}),e.jsx("p",{className:"text-textMain font-medium capitalize mt-1",children:((g=s.productType)==null?void 0:g.replace(/_/g," "))||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Product Status"}),e.jsx("div",{className:"mt-1 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-500/10 text-blue-500 border border-blue-500/20",children:((f=s.productStatus)==null?void 0:f.replace(/_/g," "))||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Tech Stack"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.techStack?s.techStack.split(",").map((r,$)=>e.jsx("span",{className:"px-2 py-1 bg-surface border border-border rounded text-xs font-mono text-textSecondary",children:r.trim()},$)):e.jsx("span",{className:"text-textMuted text-sm",children:"-"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-textMuted uppercase mb-2 block",children:"Problem Statement / Description"}),e.jsx("div",{className:"bg-surfaceHighlight/30 p-4 rounded-lg border border-border text-sm text-textSecondary leading-relaxed min-h-[120px]",children:s.description||"No description provided."})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-textMain uppercase tracking-wide border-b border-border pb-2 mb-4 flex items-center gap-2",children:[e.jsx(U,{size:16,className:"text-accent-primary"})," Verification"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"External Links"}),e.jsxs("div",{className:"space-y-2",children:[(z=s.links)!=null&&z.website?e.jsxs("a",{href:s.links.website,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 p-3 rounded-lg bg-surface border border-border hover:border-accent-primary/50 transition-colors group",children:[e.jsx(E,{size:16,className:"text-textMuted group-hover:text-accent-primary"}),e.jsx("span",{className:"text-sm text-textMain truncate flex-1",children:s.links.website}),e.jsx(_,{size:12,className:"text-textMuted"})]}):e.jsx("div",{className:"text-sm text-textMuted italic",children:"No Website provided"}),(A=s.links)!=null&&A.demo?e.jsxs("a",{href:s.links.demo,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 p-3 rounded-lg bg-surface border border-border hover:border-accent-primary/50 transition-colors group",children:[e.jsx(P,{size:16,className:"text-textMuted group-hover:text-accent-primary"}),e.jsx("span",{className:"text-sm text-textMain truncate flex-1",children:s.links.demo}),e.jsx(_,{size:12,className:"text-textMuted"})]}):e.jsx("div",{className:"text-sm text-textMuted italic",children:"No Demo provided"}),(H=s.links)!=null&&H.github?e.jsxs("a",{href:s.links.github,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 p-3 rounded-lg bg-surface border border-border hover:border-accent-primary/50 transition-colors group",children:[e.jsx(q,{size:16,className:"text-textMuted group-hover:text-accent-primary"}),e.jsx("span",{className:"text-sm text-textMain truncate flex-1",children:s.links.github}),e.jsx(_,{size:12,className:"text-textMuted"})]}):e.jsx("div",{className:"text-sm text-textMuted italic",children:"No GitHub provided"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-textMuted uppercase mb-3 block",children:"Ownership Declaration"}),e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg border ${s.hasFullRights?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"}`,children:[s.hasFullRights?e.jsx(T,{size:20,className:"text-green-500 shrink-0 mt-0.5"}):e.jsx(R,{size:20,className:"text-red-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-bold text-sm ${s.hasFullRights?"text-green-500":"text-red-500"}`,children:s.hasFullRights?"Confirmed 100% Ownership":"Ownership NOT Confirmed"}),e.jsx("p",{className:"text-xs text-textMuted mt-1",children:"User has asserted they own all rights to this project and its code."})]})]})]})]})]})]}),n?e.jsxs("div",{className:"p-6 border-t border-border bg-red-500/5 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-red-500 flex items-center gap-2",children:[e.jsx(R,{size:18})," Reject Application"]}),e.jsx("button",{onClick:()=>j(!1),className:"text-sm text-textMuted hover:text-textMain",children:"Cancel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-textMuted uppercase mb-2",children:"Rejection Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("soft"),className:`flex-1 py-2 px-3 rounded-lg border text-sm font-medium transition-colors ${c==="soft"?"bg-amber-500/10 border-amber-500 text-amber-500":"bg-surface border-border opacity-50"}`,children:"Soft Reject"}),e.jsx("button",{onClick:()=>u("hard"),className:`flex-1 py-2 px-3 rounded-lg border text-sm font-medium transition-colors ${c==="hard"?"bg-red-500/10 border-red-500 text-red-500":"bg-surface border-border opacity-50"}`,children:"Hard Reject"})]})]}),c==="soft"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-textMuted uppercase mb-2",children:"Cooldown"}),e.jsx("div",{className:"flex gap-2",children:[7,14,30].map(r=>e.jsxs("button",{onClick:()=>k(r),className:`px-3 py-2 rounded-lg border text-sm font-bold ${v===r?"bg-surfaceHighlight border-textMain text-textMain":"bg-surface border-border text-textMuted"}`,children:[r,"d"]},r))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-textMain mb-1",children:["Public Reason (Required) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"w-full bg-surface border border-border rounded-lg p-3 text-sm focus:border-red-500 focus:outline-none",rows:2,value:d,onChange:r=>h(r.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:"Internal Notes"}),e.jsx("textarea",{className:"w-full bg-surface border border-border rounded-lg p-3 text-sm focus:border-red-500 focus:outline-none",rows:1,value:N,onChange:r=>o(r.target.value)})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:x,disabled:i,className:"px-6 py-2 bg-red-500 text-white rounded-lg font-bold text-sm hover:bg-red-600 transition-colors shadow-lg",children:i?"Processing...":"Confirm Rejection"})})]}):e.jsxs("div",{className:"p-6 border-t border-border bg-surfaceHighlight/10 flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-textMuted",children:"Decision triggers email notification."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>j(!0),disabled:i,className:"px-4 py-2 rounded-lg border border-red-500/20 text-red-500 hover:bg-red-500/10 font-bold text-sm flex items-center gap-2",children:[e.jsx(R,{size:16})," Reject..."]}),e.jsxs("button",{onClick:()=>M(l.id),disabled:i,className:"px-4 py-2 rounded-lg bg-green-500 text-white hover:bg-green-600 font-bold text-sm shadow-lg flex items-center gap-2",children:[e.jsx(T,{size:16})," Approve Seller"]})]})]})]})]})},re=()=>{const{users:y,isLoading:p,refetch:l}=K(),[m,M]=a.useState(""),[b,w]=a.useState("all"),[n,j]=a.useState("all"),[c,u]=a.useState(null),[d,h]=a.useState(null),[N,o]=a.useState(!1),v=async(t,s)=>{u(t);try{const i={seller_status:s==="approve"?"approved":"rejected",seller_reviewed_at:new Date().toISOString(),...s==="approve"?{is_seller:!0,role:"seller"}:{}},{error:x}=await I.from("profiles").update(i).eq("id",t);if(x)throw x;o(!1),h(null),l()}catch(i){console.error("Error updating seller status:",i),alert("Failed to update status")}finally{u(null)}},k=t=>{h(t),o(!0)},S=y.filter(t=>{var g,f;const s=((g=t.full_name)==null?void 0:g.toLowerCase().includes(m.toLowerCase()))||((f=t.email)==null?void 0:f.toLowerCase().includes(m.toLowerCase())),i=b==="all"||t.role===b,x=n==="all"||n==="pending"&&t.seller_status==="pending";return s&&i&&x});return p?e.jsx("div",{className:"p-8 text-center text-textMuted",children:"Loading users..."}):e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-textMain mb-2",children:"Users"}),e.jsx("p",{className:"text-textMuted",children:"Manage user accounts and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j(n==="all"?"pending":"all"),className:`px-4 py-2 rounded-lg border font-medium transition-colors flex items-center gap-2 ${n==="pending"?"bg-amber-500/10 border-amber-500 text-amber-500":"bg-surface border-border text-textMuted hover:text-textMain"}`,children:[e.jsx(C,{size:16}),n==="pending"?"Showing Pending Applications":"Show Pending Applications"]}),e.jsx("button",{className:"px-4 py-2 bg-accent-primary text-textInverse rounded-lg font-medium hover:bg-accent-secondary transition-colors",children:"Add User"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-textMuted",size:20}),e.jsx("input",{type:"text",placeholder:"Search users...",value:m,onChange:t=>M(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-surface border border-border rounded-lg text-textMain focus:outline-none focus:border-accent-primary"})]}),e.jsx("div",{className:"flex gap-2",children:["all","seller","user","admin"].map(t=>e.jsxs("button",{onClick:()=>w(t),className:`px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${b===t?"bg-surfaceHighlight border-accent-primary text-accent-primary":"bg-surface border-border text-textMuted hover:text-textMain"}`,children:[t.charAt(0).toUpperCase()+t.slice(1),"s"]},t))})]}),e.jsx("div",{className:"bg-surface border border-border rounded-xl overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surfaceHighlight border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-textMuted uppercase",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-textMuted uppercase",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-textMuted uppercase",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 text-xs font-semibold text-textMuted uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:S.map(t=>e.jsxs("tr",{className:"hover:bg-surfaceHighlight/50 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-surfaceHighlight flex items-center justify-center text-textMuted",children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):e.jsx(L,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-textMain",children:t.full_name}),e.jsx("p",{className:"text-xs text-textMuted",children:t.email})]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${t.role==="admin"?"bg-purple-500/10 text-purple-500 border-purple-500/20":t.role==="seller"?"bg-blue-500/10 text-blue-500 border-blue-500/20":"bg-surfaceHighlight text-textMuted border-border"}`,children:[t.role==="admin"&&e.jsx(U,{size:12}),t.role.charAt(0).toUpperCase()+t.role.slice(1)]}),t.seller_status==="pending"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-amber-500/10 text-amber-500 border border-amber-500/20 uppercase tracking-wider animate-pulse",children:[e.jsx(C,{size:12})," Pending Review"]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-500 border border-green-500/20",children:[e.jsx(B,{size:12}),"Active"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:t.seller_status==="pending"?e.jsxs("button",{onClick:()=>k(t),className:"px-3 py-1.5 bg-accent-primary text-textInverse rounded-lg font-bold text-xs flex items-center gap-2 hover:bg-accent-secondary transition-colors",children:[e.jsx(X,{size:14})," Review Application"]}):e.jsx("button",{className:"p-1 hover:bg-surfaceHighlight rounded text-textMuted hover:text-textMain transition-colors",children:e.jsx(J,{size:16})})})]},t.id))})]})}),e.jsx(V,{isOpen:N,onClose:()=>{o(!1),h(null)},user:d,data:d==null?void 0:d.seller_application_data,onApprove:t=>v(t,"approve"),onReject:()=>{},onActionComplete:()=>{l(),o(!1)},isProcessing:!!c})]})};export{re as default};
