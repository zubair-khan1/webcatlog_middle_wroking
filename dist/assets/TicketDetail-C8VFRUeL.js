const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-76QHltB_.js","assets/vendor-motion-Dl8lXUsH.js","assets/vendor-icons-BBHJ0ezg.js","assets/vendor-react-Ojr5pEEK.js","assets/vendor-supabase-CIvuJI4W.js","assets/vendor-date-BvD7TL1z.js"])))=>i.map(i=>d[i]);
import{b as T,B as f,_ as L}from"./index-76QHltB_.js";import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a as j,a2 as z,L as N,ag as A,ax as D,h as R,U,aU as $,v as H,x as B}from"./vendor-icons-BBHJ0ezg.js";import{a as E,b as P,c as O}from"./useTickets-DIdC8N1E.js";import{e as q,u as I,L as v}from"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const X=()=>{const{id:i}=q();I();const{user:a}=T(),{ticket:s,messages:d,isLoading:w,error:o,refetch:x}=E(i),{sendMessage:y,isLoading:m}=P(),{updateStatus:M,isLoading:u}=O(),[l,p]=j.useState(""),[k,_]=j.useState(!1);z.useEffect(()=>{(async()=>{if(!a)return;const{data:r}=await(await L(async()=>{const{supabase:n}=await import("./index-76QHltB_.js").then(c=>c.c);return{supabase:n}},__vite__mapDeps([0,1,2,3,4,5]))).supabase.from("profiles").select("role").eq("id",a.id).single();_((r==null?void 0:r.role)==="admin")})()},[a]);const S=async t=>{if(t.preventDefault(),!l.trim()||!i)return;(await y(i,l.trim())).success&&(p(""),x())},h=async t=>{if(!i)return;(await M(i,t)).success&&x()},C=t=>{switch(t){case"open":return"bg-blue-500/10 text-blue-400 border-blue-500/20";case"waiting":return"bg-amber-500/10 text-amber-400 border-amber-500/20";case"under_review":return"bg-purple-500/10 text-purple-400 border-purple-500/20";case"resolved":return"bg-green-500/10 text-green-400 border-green-500/20";default:return"bg-surfaceHighlight text-textMuted border-border"}};return w?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(N,{className:"animate-spin text-accent-primary",size:32})}):o||!s?e.jsxs("div",{className:"pt-32 pb-20 px-6 max-w-3xl mx-auto text-center",children:[e.jsx(A,{size:48,className:"mx-auto text-red-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-textMain mb-2",children:"Ticket Not Found"}),e.jsx("p",{className:"text-textMuted mb-6",children:o||"This ticket doesn't exist or you don't have access."}),e.jsx(v,{to:"/tickets",children:e.jsx(f,{variant:"outline",children:"Back to Tickets"})})]}):e.jsxs("div",{className:"pt-32 pb-20 px-6 max-w-4xl mx-auto animate-fade-in",children:[e.jsxs(v,{to:"/tickets",className:"inline-flex items-center gap-2 text-textMuted hover:text-textMain mb-6 transition-colors",children:[e.jsx(D,{size:16}),"Back to Tickets"]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-mono text-textMuted",children:s.ticket_number}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${C(s.status)}`,children:s.status.replace("_"," ")})]}),e.jsx("h1",{className:"text-2xl font-display font-bold text-textMain",children:s.subject})]}),k&&s.status!=="resolved"&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.status!=="under_review"&&e.jsx("button",{onClick:()=>h("under_review"),disabled:u,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-purple-500/10 text-purple-400 border border-purple-500/20 hover:bg-purple-500/20 transition-colors",children:"Mark Under Review"}),e.jsx("button",{onClick:()=>h("resolved"),disabled:u,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20 transition-colors",children:"Mark Resolved"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-surfaceHighlight rounded-lg",children:[e.jsx("p",{className:"text-xs text-textMuted uppercase mb-1",children:"Category"}),e.jsx("p",{className:"text-textMain font-medium capitalize",children:s.category.replace("_"," ")})]}),e.jsxs("div",{className:"p-3 bg-surfaceHighlight rounded-lg",children:[e.jsx("p",{className:"text-xs text-textMuted uppercase mb-1",children:"Created"}),e.jsx("p",{className:"text-textMain font-medium",children:new Date(s.created_at).toLocaleDateString()})]}),s.order&&e.jsxs("div",{className:"p-3 bg-surfaceHighlight rounded-lg col-span-2",children:[e.jsx("p",{className:"text-xs text-textMuted uppercase mb-1",children:"Related Order"}),e.jsxs("p",{className:"text-textMain font-medium",children:[s.order.order_number,s.order.listing&&` â€¢ ${s.order.listing.title}`]})]})]})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-textMain mb-4 flex items-center gap-2",children:[e.jsx(R,{size:18}),"Conversation"]}),e.jsx("div",{className:"space-y-4 mb-6 max-h-[500px] overflow-y-auto",children:d.length===0?e.jsx("div",{className:"text-center py-8 text-textMuted",children:"No messages yet."}):d.map(t=>{var c,b,g;const r=t.sender_id===(a==null?void 0:a.id),n=(c=t.sender)==null?void 0:c.role;return e.jsxs("div",{className:`flex gap-3 ${r?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${n==="admin"?"bg-purple-500/20 text-purple-400":"bg-accent-primary/20 text-accent-primary"}`,children:(b=t.sender)!=null&&b.avatar_url?e.jsx("img",{src:t.sender.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):e.jsx(U,{size:18})}),e.jsxs("div",{className:`flex-1 max-w-[80%] ${r?"text-right":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:`text-sm font-medium ${n==="admin"?"text-purple-400":"text-textMain"}`,children:[((g=t.sender)==null?void 0:g.full_name)||"Unknown",n==="admin"&&" (Admin)"]}),e.jsx("span",{className:"text-xs text-textMuted",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:`p-3 rounded-lg ${r?"bg-accent-primary/10 border border-accent-primary/20":"bg-surfaceHighlight border border-border"}`,children:[e.jsx("p",{className:"text-textMain text-sm whitespace-pre-wrap",children:t.content}),t.attachment_url&&e.jsxs("a",{href:t.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 mt-2 text-xs text-accent-primary hover:underline",children:[e.jsx($,{size:12}),t.attachment_name||"Attachment"]})]})]})]},t.id)})}),s.status!=="resolved"?e.jsxs("form",{onSubmit:S,className:"flex gap-3",children:[e.jsx("input",{type:"text",value:l,onChange:t=>p(t.target.value),placeholder:"Type your message...",className:"flex-1 bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain placeholder:text-textMuted focus:border-accent-primary focus:outline-none"}),e.jsx(f,{type:"submit",disabled:m||!l.trim(),children:m?e.jsx(N,{size:16,className:"animate-spin"}):e.jsx(H,{size:16})})]}):e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg text-center",children:[e.jsx(B,{size:24,className:"mx-auto text-green-400 mb-2"}),e.jsx("p",{className:"text-green-400 font-medium",children:"This ticket has been resolved"})]})]})]})};export{X as default};
