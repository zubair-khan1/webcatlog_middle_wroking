import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a as n,h as o,ax as M,ag as w,L as g,e as S,P as C,ao as q,aV as I}from"./vendor-icons-BBHJ0ezg.js";import{d as _}from"./useTickets-DIdC8N1E.js";import{b as z,B as h,s as L}from"./index-76QHltB_.js";import{u as O,d as P,L as R}from"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const F=()=>{const u=O(),[x]=P(),{user:i,isAuthenticated:b}=z(),{createTicket:f,isLoading:m,error:p}=_(),[l,j]=n.useState([]),[y,v]=n.useState(!0),[r,c]=n.useState({orderId:x.get("order")||"",category:x.get("category")||"clarification",subject:"",message:""});n.useEffect(()=>{(async()=>{if(!i)return;const{data:s}=await L.from("orders").select("id, order_number, listing:listings(title), seller_id").eq("buyer_id",i.id).in("status",["paid","delivered","completed"]).order("created_at",{ascending:!1});j(s||[]),v(!1)})()},[i]);const N=async t=>{if(t.preventDefault(),!r.subject.trim()||!r.message.trim()){alert("Please fill in all required fields");return}const s=l.find(d=>d.id===r.orderId),a=await f({orderId:r.orderId||void 0,subject:r.subject.trim(),category:r.category,message:r.message.trim(),buyerId:i==null?void 0:i.id,sellerId:s==null?void 0:s.seller_id,involvesAdmin:r.category==="refund_request"});a.success&&u(`/tickets/${a.ticketId}`)},k=[{value:"clarification",label:"Clarification",icon:S,description:"Questions about the product"},{value:"delivery_issue",label:"Delivery Issue",icon:C,description:"Problems accessing files"},{value:"refund_request",label:"Refund Request",icon:q,description:"Request a refund (admin review)"},{value:"technical",label:"Technical",icon:I,description:"Technical issues or bugs"},{value:"other",label:"Other",icon:o,description:"Other inquiries"}];return b?e.jsxs("div",{className:"pt-32 pb-20 px-6 max-w-2xl mx-auto animate-fade-in",children:[e.jsxs(R,{to:"/tickets",className:"inline-flex items-center gap-2 text-textMuted hover:text-textMain mb-6 transition-colors",children:[e.jsx(M,{size:16}),"Back to Tickets"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-textMain mb-2",children:"Create Support Ticket"}),e.jsx("p",{className:"text-textMuted",children:"Describe your issue and we'll help you resolve it"})]}),p&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-xl flex items-start gap-3",children:[e.jsx(w,{size:18,className:"text-red-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-400 text-sm",children:p})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-mono font-medium text-textSecondary uppercase tracking-wider",children:["Related Order ",e.jsx("span",{className:"text-textMuted normal-case",children:"(optional)"})]}),y?e.jsxs("div",{className:"p-4 bg-surfaceHighlight rounded-lg flex items-center gap-2",children:[e.jsx(g,{size:16,className:"animate-spin text-textMuted"}),e.jsx("span",{className:"text-textMuted text-sm",children:"Loading your orders..."})]}):l.length===0?e.jsx("div",{className:"p-4 bg-surfaceHighlight rounded-lg text-textMuted text-sm",children:"No orders found. You can still create a general ticket."}):e.jsxs("select",{value:r.orderId,onChange:t=>c(s=>({...s,orderId:t.target.value})),className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain focus:border-accent-primary focus:outline-none",children:[e.jsx("option",{value:"",children:"No specific order"}),l.map(t=>{var s,a;return e.jsxs("option",{value:t.id,children:[t.order_number," - ",Array.isArray(t.listing)?(s=t.listing[0])==null?void 0:s.title:(a=t.listing)==null?void 0:a.title]},t.id)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-mono font-medium text-textSecondary uppercase tracking-wider",children:["Category ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:k.map(t=>{const s=t.icon,a=r.category===t.value;return e.jsx("button",{type:"button",onClick:()=>c(d=>({...d,category:t.value})),className:`p-4 rounded-xl border text-left transition-all ${a?"bg-accent-primary/10 border-accent-primary/30 ring-1 ring-accent-primary/20":"bg-surfaceHighlight border-border hover:border-accent-primary/20"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{size:18,className:a?"text-accent-primary":"text-textMuted"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${a?"text-accent-primary":"text-textMain"}`,children:t.label}),e.jsx("p",{className:"text-xs text-textMuted",children:t.description})]})]})},t.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-mono font-medium text-textSecondary uppercase tracking-wider",children:["Subject ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:r.subject,onChange:t=>c(s=>({...s,subject:t.target.value})),placeholder:"Brief summary of your issue",className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain placeholder:text-textMuted focus:border-accent-primary focus:outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-mono font-medium text-textSecondary uppercase tracking-wider",children:["Description ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:r.message,onChange:t=>c(s=>({...s,message:t.target.value})),placeholder:"Please describe your issue in detail...",rows:5,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain placeholder:text-textMuted focus:border-accent-primary focus:outline-none resize-none",required:!0})]}),r.category==="refund_request"&&e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl",children:e.jsxs("p",{className:"text-sm text-amber-400",children:[e.jsx("strong",{children:"Note:"})," Refund requests are reviewed by our admin team. Please provide as much detail as possible about why the product didn't meet your expectations."]})}),e.jsx(h,{type:"submit",disabled:m,className:"w-full",children:m?e.jsx(g,{size:18,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(o,{size:18}),"Create Ticket"]})})]})]}):e.jsxs("div",{className:"pt-32 pb-20 px-6 min-h-[80vh] flex flex-col items-center justify-center text-center max-w-md mx-auto",children:[e.jsx(o,{size:48,className:"text-textMuted mb-6"}),e.jsx("h2",{className:"text-2xl font-display font-bold text-textMain mb-4",children:"Sign In Required"}),e.jsx("p",{className:"text-textSecondary mb-6",children:"You must be signed in to create a support ticket."}),e.jsx(h,{onClick:()=>u("/signin"),children:"Sign In"})]})};export{F as default};
