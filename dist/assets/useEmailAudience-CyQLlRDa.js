import{a as o}from"./vendor-icons-BBHJ0ezg.js";import{s as i}from"./index-76QHltB_.js";const h=(e={})=>{const[r,c]=o.useState([]),[a,u]=o.useState(!0),[n,l]=o.useState(null),t=async()=>{u(!0),l(null);try{let s=i.from("email_audience").select("*").order("created_at",{ascending:!1});e.source&&(s=s.eq("source",e.source)),e.user_type&&(s=s.eq("user_type",e.user_type)),e.status&&(s=s.eq("status",e.status)),e.search&&(s=s.ilike("email",`%${e.search}%`));const{data:m,error:f}=await s;if(f)throw f;c(m||[])}catch(s){console.error("Error fetching email audience:",s),l(s instanceof Error?s.message:"Failed to fetch emails")}finally{u(!1)}};return o.useEffect(()=>{t()},[e.source,e.user_type,e.status,e.search]),{emails:r,isLoading:a,error:n,refetch:t}},y=()=>{const[e,r]=o.useState(null),[c,a]=o.useState(!0),[u,n]=o.useState(null),l=async()=>{a(!0),n(null);try{const{data:t,error:s}=await i.from("email_audience_stats").select("*").single();if(s)throw s;r(t)}catch(t){console.error("Error fetching email stats:",t),n(t instanceof Error?t.message:"Failed to fetch stats")}finally{a(!1)}};return o.useEffect(()=>{l()},[]),{stats:e,isLoading:c,error:u,refetch:l}},E=async(e,r,c={})=>{try{const{data:a,error:u}=await i.rpc("upsert_email_record",{p_email:e,p_source:r,p_user_type:c.user_type||"guest",p_consent_flag:c.consent_flag||!1,p_linked_user_id:c.linked_user_id||null,p_metadata:c.metadata||{}});if(u)throw u;return{success:!0,error:null,id:a}}catch(a){return console.error("Error upserting email record:",a),{success:!1,error:a instanceof Error?a.message:"Failed to save email"}}},g=async(e={})=>{try{let r=i.from("email_audience").select("*").order("created_at",{ascending:!1});e.source&&(r=r.eq("source",e.source)),e.user_type&&(r=r.eq("user_type",e.user_type)),e.status&&(r=r.eq("status",e.status)),e.search&&(r=r.ilike("email",`%${e.search}%`));const{data:c,error:a}=await r;if(a)throw a;const u=["Email","Source","User Type","Status","Consent","Created At","Last Seen"],n=(c||[]).map(t=>[t.email,t.source,t.user_type,t.status,t.consent_flag?"Yes":"No",new Date(t.created_at).toLocaleDateString(),new Date(t.last_seen_at).toLocaleDateString()]);return{success:!0,error:null,csv:[u.join(","),...n.map(t=>t.map(s=>`"${s}"`).join(","))].join(`
`)}}catch(r){return console.error("Error exporting emails:",r),{success:!1,error:r instanceof Error?r.message:"Failed to export"}}};export{y as a,h as b,g as e,E as u};
