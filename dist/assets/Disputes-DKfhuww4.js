import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a,ao as S,x as p,ar as z,at as E,aN as H}from"./vendor-icons-BBHJ0ezg.js";import{s as b}from"./index-76QHltB_.js";import"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const I=()=>{var v,_;const[d,k]=a.useState([]),[D,f]=a.useState(!0),[h,R]=a.useState(null),[n,o]=a.useState(null),[x,m]=a.useState(""),[g,j]=a.useState(!1),u=async()=>{f(!0);try{const{data:t,error:s}=await b.from("disputes").select(`
          *,
          order:orders(
            id, order_number, price_amount, status,
            listing:listings(id, title),
            buyer:profiles!orders_buyer_id_fkey(id, full_name, email),
            seller:profiles!orders_seller_id_fkey(id, full_name, email)
          ),
          raiser:profiles!disputes_raised_by_fkey(id, full_name, email)
        `).order("created_at",{ascending:!1});if(s)throw s;k(t||[])}catch(t){R(t instanceof Error?t.message:"Failed to fetch disputes")}finally{f(!1)}};a.useEffect(()=>{u()},[]);const N=async(t,s)=>{var l;if(!x.trim()){alert("Please provide a resolution note");return}j(!0);try{const{error:i}=await b.from("disputes").update({status:s,resolution:x,resolved_at:new Date().toISOString()}).eq("id",t);if(i)throw i;if(s==="resolved_refund"){const r=d.find(c=>c.id===t);(l=r==null?void 0:r.order)!=null&&l.id&&await b.from("orders").update({status:"refunded"}).eq("id",r.order.id)}o(null),m(""),u()}catch{alert("Failed to resolve dispute")}finally{j(!1)}},C=t=>{const s={open:{bg:"bg-orange-500/10 text-orange-500",icon:e.jsx(H,{size:14})},under_review:{bg:"bg-accent-tertiary/10 text-accent-tertiary",icon:e.jsx(E,{size:14})},resolved_refund:{bg:"bg-accent-primary/10 text-accent-primary",icon:e.jsx(p,{size:14})},resolved_no_refund:{bg:"bg-accent-secondary/10 text-accent-secondary-fg",icon:e.jsx(z,{size:14})},closed:{bg:"bg-surfaceHighlight text-textMuted",icon:e.jsx(p,{size:14})}};return s[t]||s.open};if(D)return e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full"})});const y=d.filter(t=>["open","under_review"].includes(t.status));return e.jsxs("div",{className:"space-y-8 animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-textMain mb-2",children:"Disputes"}),e.jsxs("p",{className:"text-textMuted",children:[y.length," open dispute",y.length!==1?"s":""," requiring attention"]})]}),e.jsx("button",{onClick:u,className:"p-2 rounded-lg bg-surfaceHighlight hover:bg-accent-tertiary/10 text-textMuted hover:text-accent-tertiary transition-colors",children:e.jsx(S,{size:18})})]}),h&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-500",children:h}),d.length===0?e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-12 text-center",children:[e.jsx(p,{size:48,className:"text-accent-primary mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-textMain font-medium text-lg",children:"No disputes"}),e.jsx("p",{className:"text-textMuted text-sm",children:"All clear! No disputes to resolve."})]}):e.jsx("div",{className:"space-y-4",children:d.map(t=>{var l,i,r,c,M,w;const s=C(t.status);return e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 hover:border-accent-primary/20 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:`flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium ${s.bg}`,children:[s.icon,t.status.replace("_"," ")]}),e.jsxs("span",{className:"text-textMuted text-sm",children:["Order #",(l=t.order)==null?void 0:l.order_number]})]}),e.jsx("h3",{className:"font-bold text-textMain",children:((r=(i=t.order)==null?void 0:i.listing)==null?void 0:r.title)||"Unknown Kit"})]}),e.jsx("p",{className:"text-sm text-textMuted",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-surfaceHighlight",children:[e.jsx("p",{className:"text-xs text-textMuted mb-1",children:"Raised by"}),e.jsx("p",{className:"text-sm text-textMain",children:(c=t.raiser)==null?void 0:c.full_name}),e.jsx("p",{className:"text-xs text-textMuted",children:(M=t.raiser)==null?void 0:M.email})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-surfaceHighlight",children:[e.jsx("p",{className:"text-xs text-textMuted mb-1",children:"Order Value"}),e.jsxs("p",{className:"text-sm font-medium text-textMain",children:["₹",(w=t.order)==null?void 0:w.price_amount]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-textMuted uppercase mb-2",children:"Reason"}),e.jsxs("p",{className:"text-sm text-textMain bg-red-500/5 border border-red-500/10 rounded-lg p-3",children:[e.jsx("strong",{children:t.reason}),t.description&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"text-textMuted",children:t.description})]})]})]}),t.resolution&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-textMuted uppercase mb-2",children:"Resolution"}),e.jsx("p",{className:"text-sm text-textMain bg-accent-primary/5 border border-accent-primary/10 rounded-lg p-3",children:t.resolution})]}),["open","under_review"].includes(t.status)&&e.jsx("button",{onClick:()=>o(t),className:"px-4 py-2 bg-accent-tertiary/10 text-accent-tertiary rounded-xl font-medium hover:bg-accent-tertiary/20 transition-colors",children:"Resolve Dispute"})]},t.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface border border-border rounded-2xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-display font-bold text-textMain mb-4",children:"Resolve Dispute"}),e.jsxs("div",{className:"mb-4 p-3 rounded-xl bg-surfaceHighlight",children:[e.jsxs("p",{className:"text-sm text-textMain",children:["Order #",(v=n.order)==null?void 0:v.order_number]}),e.jsxs("p",{className:"text-xs text-textMuted",children:["Value: ₹",(_=n.order)==null?void 0:_.price_amount]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-textMuted mb-2",children:"Resolution Notes"}),e.jsx("textarea",{value:x,onChange:t=>m(t.target.value),rows:3,className:"w-full px-4 py-3 bg-surfaceHighlight border border-border rounded-xl text-textMain placeholder:text-textMuted focus:outline-none focus:border-accent-tertiary resize-none",placeholder:"Explain the resolution..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>N(n.id,"resolved_refund"),disabled:g,className:"flex-1 px-4 py-3 bg-accent-primary text-accent-primary-fg rounded-xl font-medium hover:brightness-110 disabled:opacity-50",children:"Approve Refund"}),e.jsx("button",{onClick:()=>N(n.id,"resolved_no_refund"),disabled:g,className:"flex-1 px-4 py-3 bg-surfaceHighlight text-textMuted hover:text-textMain rounded-xl font-medium disabled:opacity-50",children:"Deny Refund"})]}),e.jsx("button",{onClick:()=>{o(null),m("")},className:"w-full mt-3 px-4 py-2 text-textMuted hover:text-textMain text-sm",children:"Cancel"})]})})]})};export{I as default};
