import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a as l,L as $,at as w,aH as _,x as k,p as R,G as D,s as P,ar as S,aN as H,h as U,P as B,U as G}from"./vendor-icons-BBHJ0ezg.js";import{s as z,b as T}from"./index-76QHltB_.js";import"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const O=s=>{const[u,c]=l.useState([]),[g,n]=l.useState(!0),[m,a]=l.useState(null),[r,b]=l.useState({pending:0,reviewing:0,resolved:0,total:0}),p=l.useCallback(async()=>{n(!0),a(null);try{let o=z.from("abuse_reports").select(`
                    *,
                    reporter:profiles!abuse_reports_reporter_id_fkey(id, full_name, email),
                    reviewer:profiles!abuse_reports_reviewed_by_fkey(id, full_name)
                `).order("created_at",{ascending:!1});s!=null&&s.status&&(o=o.eq("status",s.status)),s!=null&&s.targetType&&(o=o.eq("target_type",s.targetType));const{data:v,error:h}=await o;if(h)throw h;const i=v||[];c(i),b({pending:i.filter(d=>d.status==="pending").length,reviewing:i.filter(d=>d.status==="reviewing").length,resolved:i.filter(d=>d.status==="resolved_action_taken"||d.status==="resolved_no_action"||d.status==="dismissed").length,total:i.length})}catch(o){a(o instanceof Error?o.message:"Failed to fetch abuse reports")}finally{n(!1)}},[s==null?void 0:s.status,s==null?void 0:s.targetType]);return l.useEffect(()=>{p()},[p]),{reports:u,isLoading:g,error:m,refetch:p,counts:r}},X=()=>{const{user:s}=T(),[u,c]=l.useState(!1),[g,n]=l.useState(null);return{resolveReport:async a=>{if(!s)return n("Not authenticated"),!1;c(!0),n(null);try{const{error:r}=await z.from("abuse_reports").update({status:a.resolution,resolution_notes:a.notes,action_taken:a.actionTaken,reviewed_by:s.id,reviewed_at:new Date().toISOString()}).eq("id",a.reportId);if(r)throw r;return!0}catch(r){return n(r instanceof Error?r.message:"Failed to resolve report"),!1}finally{c(!1)}},isLoading:u,error:g}},J=()=>{const{user:s}=T(),[u,c]=l.useState(!1),[g,n]=l.useState(null);return{startReview:async a=>{if(!s)return n("Not authenticated"),!1;c(!0),n(null);try{const{error:r}=await z.from("abuse_reports").update({status:"reviewing",reviewed_by:s.id}).eq("id",a).eq("status","pending");if(r)throw r;return!0}catch(r){return n(r instanceof Error?r.message:"Failed to start review"),!1}finally{c(!1)}},isLoading:u,error:g}},ee=()=>{const[s,u]=l.useState("pending"),{reports:c,isLoading:g,error:n,refetch:m,counts:a}=O({status:s}),{resolveReport:r,isLoading:b}=X(),{startReview:p,isLoading:o}=J(),[v,h]=l.useState(null),[i,d]=l.useState(""),[M,C]=l.useState(""),A=t=>{const x={spam:{color:"text-yellow-400",bg:"bg-yellow-500/10"},fraud:{color:"text-red-500",bg:"bg-red-500/10"},harassment:{color:"text-orange-400",bg:"bg-orange-500/10"},copyright:{color:"text-purple-400",bg:"bg-purple-500/10"},inappropriate:{color:"text-pink-400",bg:"bg-pink-500/10"},fake:{color:"text-red-400",bg:"bg-red-500/10"},other:{color:"text-gray-400",bg:"bg-gray-500/10"}};return x[t]||x.other},q=t=>{switch(t){case"pending":return{color:"text-yellow-400",bg:"bg-yellow-500/10",icon:e.jsx(w,{size:14})};case"reviewing":return{color:"text-blue-400",bg:"bg-blue-500/10",icon:e.jsx(_,{size:14})};case"resolved_action_taken":return{color:"text-green-400",bg:"bg-green-500/10",icon:e.jsx(k,{size:14})};case"resolved_no_action":return{color:"text-gray-400",bg:"bg-gray-500/10",icon:e.jsx(S,{size:14})};case"dismissed":return{color:"text-red-400",bg:"bg-red-500/10",icon:e.jsx(S,{size:14})};default:return{color:"text-gray-400",bg:"bg-gray-500/10",icon:e.jsx(w,{size:14})}}},F=t=>{switch(t){case"user":return e.jsx(G,{size:16,className:"text-blue-400"});case"listing":return e.jsx(B,{size:16,className:"text-green-400"});case"message":return e.jsx(U,{size:16,className:"text-purple-400"});default:return e.jsx(R,{size:16,className:"text-gray-400"})}},I=async t=>{await p(t)&&m()},j=async(t,x)=>{await r({reportId:t,resolution:x,notes:i,actionTaken:x==="resolved_action_taken"?M:void 0})&&(h(null),d(""),C(""),m())};return g?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx($,{className:"animate-spin text-blue-500",size:32})}):n?e.jsx("div",{className:"p-6 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxs("p",{className:"text-red-400",children:["Error: ",n]})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Abuse Reports"}),e.jsx("p",{className:"text-textMuted",children:"Review and resolve user-submitted reports"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-surface border border-border rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{size:16,className:"text-yellow-400"}),e.jsx("span",{className:"text-sm text-textMuted",children:"Pending"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.pending})]}),e.jsxs("div",{className:"p-4 bg-surface border border-border rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-sm text-textMuted",children:"Reviewing"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.reviewing})]}),e.jsxs("div",{className:"p-4 bg-surface border border-border rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{size:16,className:"text-green-400"}),e.jsx("span",{className:"text-sm text-textMuted",children:"Resolved"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.resolved})]}),e.jsxs("div",{className:"p-4 bg-surface border border-border rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{size:16,className:"text-textMuted"}),e.jsx("span",{className:"text-sm text-textMuted",children:"Total"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.total})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-textMuted",children:[e.jsx(D,{size:16}),e.jsx("span",{className:"text-sm",children:"Status:"})]}),e.jsx("div",{className:"flex gap-2",children:[{value:"pending",label:"Pending"},{value:"reviewing",label:"Reviewing"},{value:void 0,label:"All"}].map(t=>e.jsx("button",{onClick:()=>u(t.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${s===t.value?"bg-accent-primary/20 text-accent-primary":"bg-surface border border-border text-textMuted hover:text-textMain"}`,children:t.label},t.label))})]}),e.jsx("div",{className:"bg-surface border border-border rounded-xl overflow-hidden",children:c.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(R,{size:48,className:"mx-auto text-textMuted mb-4 opacity-50"}),e.jsx("p",{className:"text-textMuted",children:"No reports found"})]}):e.jsx("div",{className:"divide-y divide-border",children:c.map(t=>{var L,E;const x=A(t.report_type),f=q(t.status),y=v===t.id;return e.jsx("div",{className:"hover:bg-surfaceHighlight transition-colors",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-surfaceHighlight rounded-lg",children:F(t.target_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${x.bg} ${x.color}`,children:t.report_type}),e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium flex items-center gap-1 ${f.bg} ${f.color}`,children:[f.icon,t.status.replace(/_/g," ")]}),e.jsxs("span",{className:"text-xs text-textMuted",children:["on ",t.target_type]})]}),e.jsx("p",{className:"text-sm text-textMain mb-2 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-textMuted",children:[e.jsxs("span",{children:["Reported by: ",((L=t.reporter)==null?void 0:L.full_name)||((E=t.reporter)==null?void 0:E.email)||"Anonymous"]}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&e.jsxs("button",{onClick:()=>I(t.id),disabled:o,className:"px-3 py-1.5 bg-blue-500/10 text-blue-400 rounded-lg text-sm font-medium hover:bg-blue-500/20 transition-colors flex items-center gap-1",children:[e.jsx(_,{size:14}),"Review"]}),(t.status==="pending"||t.status==="reviewing")&&e.jsxs("button",{onClick:()=>h(y?null:t.id),className:"px-3 py-1.5 bg-accent-primary/10 text-accent-primary rounded-lg text-sm font-medium hover:bg-accent-primary/20 transition-colors flex items-center gap-1",children:["Resolve",e.jsx(P,{size:14,className:`transition-transform ${y?"rotate-90":""}`})]})]})]}),y&&e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-textMuted mb-2",children:"Resolution Notes"}),e.jsx("textarea",{value:i,onChange:N=>d(N.target.value),placeholder:"Describe your resolution...",className:"w-full px-4 py-3 bg-background border border-border rounded-lg text-textMain placeholder:text-textMuted focus:outline-none focus:border-accent-primary resize-none",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-textMuted mb-2",children:"Action Taken (optional)"}),e.jsx("input",{type:"text",value:M,onChange:N=>C(N.target.value),placeholder:"e.g., User warned, Listing removed...",className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-textMain placeholder:text-textMuted focus:outline-none focus:border-accent-primary"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>j(t.id,"resolved_action_taken"),disabled:b||!i,className:"px-4 py-2 bg-green-500/10 text-green-400 rounded-lg text-sm font-medium hover:bg-green-500/20 transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(k,{size:14}),"Action Taken"]}),e.jsxs("button",{onClick:()=>j(t.id,"resolved_no_action"),disabled:b||!i,className:"px-4 py-2 bg-gray-500/10 text-gray-400 rounded-lg text-sm font-medium hover:bg-gray-500/20 transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(S,{size:14}),"No Action Needed"]}),e.jsxs("button",{onClick:()=>j(t.id,"dismissed"),disabled:b||!i,className:"px-4 py-2 bg-red-500/10 text-red-400 rounded-lg text-sm font-medium hover:bg-red-500/20 transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(H,{size:14}),"Dismiss"]})]})]})})]})},t.id)})})})]})};export{ee as default};
