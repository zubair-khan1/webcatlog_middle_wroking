import{a as q}from"./vendor-icons-BBHJ0ezg.js";import{b as j,s as m}from"./index-76QHltB_.js";const c=async(s,f,l)=>{const a=s.name.split(".").pop(),r=`${f}/${l}/${Date.now()}.${a}`;try{const{data:n,error:e}=await m.storage.from("submissions").upload(r,s,{cacheControl:"3600",upsert:!1});if(e)return console.warn("Storage upload skipped:",e.message),null;const{data:u}=m.storage.from("submissions").getPublicUrl(n.path);return u.publicUrl}catch(n){return console.warn("Storage upload error:",n),null}},$=()=>{const{user:s}=j(),[f,l]=q.useState(!1),[a,r]=q.useState(0);return{submitKit:async e=>{var u,p,g,b,_,y,F,w,S,k;if(!s)return{success:!1,error:"You must be logged in to submit"};if(!e.ownerDeclaration||!e.rightsDeclaration)return{success:!1,error:"You must accept both declarations to submit"};if(!e.projectName.trim())return{success:!1,error:"Kit name is required"};if(!e.shortSummary.trim())return{success:!1,error:"Short summary is required"};if(!e.description.trim())return{success:!1,error:"Description is required"};if(!e.techStack||e.techStack.length===0)return{success:!1,error:"Tech stack is required"};if(!e.price||parseFloat(e.price)<=0)return{success:!1,error:"Valid price is required"};l(!0),r(0);try{let t=null,v=null;const h=[];if(e.thumbnailFile&&(r(10),t=await c(e.thumbnailFile,s.id,"thumbnails"),r(30)),e.videoFile&&(r(40),v=await c(e.videoFile,s.id,"videos"),r(60)),e.screenshotFiles&&e.screenshotFiles.length>0){r(70);for(const o of e.screenshotFiles){const i=await c(o,s.id,"screenshots");i&&h.push(i)}r(80)}r(90);const{data:d,error:U}=await m.from("submissions").insert({user_id:s.id,project_name:e.projectName.trim(),tagline:((u=e.tagline)==null?void 0:u.trim())||null,short_summary:e.shortSummary.trim(),description:e.description.trim(),category:e.category,live_url:((p=e.liveUrl)==null?void 0:p.trim())||null,repo_url:((g=e.repoUrl)==null?void 0:g.trim())||null,tech_stack:Array.isArray(e.techStack)?e.techStack.join(", "):e.techStack,setup_time:e.setupTime,architecture_notes:((b=e.architectureNotes)==null?void 0:b.trim())||null,price:parseFloat(e.price)||0,features:((_=e.features)==null?void 0:_.trim())||null,deliverables:((y=e.deliverables)==null?void 0:y.length)>0?e.deliverables:null,perfect_for:((F=e.perfectFor)==null?void 0:F.length)>0?e.perfectFor:null,not_for:((w=e.notFor)==null?void 0:w.length)>0?e.notFor:null,what_buyer_gets:((S=e.whatBuyerGets)==null?void 0:S.length)>0?e.whatBuyerGets:null,thumbnail_url:t,video_url:v||((k=e.demoVideoUrl)==null?void 0:k.trim())||null,screenshot_urls:h.length>0?h:null,owner_declaration:e.ownerDeclaration,rights_declaration:e.rightsDeclaration,declaration_at:new Date().toISOString(),status:"pending"}).select("id").single();if(U)throw U;if(e.resourceFiles&&e.resourceFiles.length>0){r(92);for(let o=0;o<e.resourceFiles.length;o++){const i=e.resourceFiles[o],D=await c(i.file,s.id,"resources");D&&await m.from("kit_resources").insert({submission_id:d.id,file_name:i.file.name,file_type:i.type,file_url:D,file_size_bytes:i.file.size,description:i.description||null,linked_deliverable:i.linkedDeliverable||null,is_locked:!1}),r(92+Math.floor((o+1)/e.resourceFiles.length*6))}}return r(100),{success:!0,error:null,submissionId:d.id}}catch(t){return console.error("Submission error:",t),{success:!1,error:t instanceof Error?t.message:"Failed to submit kit"}}finally{l(!1)}},uploadProgress:a,isLoading:f}};export{$ as u};
