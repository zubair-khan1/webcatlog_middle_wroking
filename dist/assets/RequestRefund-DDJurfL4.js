import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a as c,a2 as C,ag as x,L as g,x as E,ax as O,aR as z,aJ as A,P as D,ar as L,e as P}from"./vendor-icons-BBHJ0ezg.js";import{u as I}from"./useRefundsAndWithdrawals-DUJgh36L.js";import{b as B,B as d,s as T}from"./index-76QHltB_.js";import{e as F,u as Y,L as l}from"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const X=()=>{var j;const{orderId:a}=F(),N=Y(),{user:o,isAuthenticated:y}=B(),{createRequest:v,isLoading:u,error:m}=I(),[n,w]=c.useState(null),[M,p]=c.useState(!0),[h,f]=c.useState(null),[R,_]=c.useState(!1),[r,b]=c.useState({reason:"",description:""});C.useEffect(()=>{(async()=>{if(!a||!o){p(!1);return}try{const{data:t,error:i}=await T.from("orders").select("id, order_number, price_amount, created_at, listing:listings(title), buyer_id").eq("id",a).single();if(i)throw i;if(t.buyer_id!==o.id){f("You can only request refunds for your own orders");return}w({id:t.id,order_number:t.order_number,price_amount:t.price_amount,created_at:t.created_at,listing:Array.isArray(t.listing)?t.listing[0]:t.listing})}catch(t){f(t instanceof Error?t.message:"Failed to load order")}finally{p(!1)}})()},[a,o]);const k=async s=>{if(s.preventDefault(),!r.reason||!r.description.trim()||!a)return;(await v({orderId:a,reason:r.reason,description:r.description.trim()})).success&&_(!0)},S=[{value:"not_as_described",label:"Not as Described",icon:z,description:"The product differs significantly from its listing"},{value:"technical_issues",label:"Technical Issues",icon:A,description:"Code errors, bugs, or setup problems"},{value:"missing_files",label:"Missing Files",icon:D,description:"Expected files or resources are not included"},{value:"quality_issues",label:"Quality Issues",icon:L,description:"Code quality or documentation is poor"},{value:"other",label:"Other",icon:P,description:"Another reason not listed above"}];return y?M?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(g,{className:"animate-spin text-accent-primary",size:32})}):h||!n?e.jsxs("div",{className:"pt-32 pb-20 px-6 max-w-2xl mx-auto text-center",children:[e.jsx(x,{size:48,className:"mx-auto text-red-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-textMain mb-2",children:"Error"}),e.jsx("p",{className:"text-textMuted mb-6",children:h||"Order not found"}),e.jsx(l,{to:"/dashboard",children:e.jsx(d,{variant:"outline",children:"Back to Dashboard"})})]}):R?e.jsx("div",{className:"pt-32 pb-20 px-6 max-w-2xl mx-auto text-center animate-fade-in",children:e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-2xl p-8",children:[e.jsx(E,{size:64,className:"mx-auto text-green-400 mb-6"}),e.jsx("h2",{className:"text-2xl font-display font-bold text-textMain mb-4",children:"Refund Request Submitted"}),e.jsx("p",{className:"text-textMuted mb-6",children:"Your refund request has been submitted for review. Our team will review it and get back to you within 2-3 business days."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(l,{to:"/tickets",children:e.jsx(d,{variant:"outline",children:"View Your Tickets"})}),e.jsx(l,{to:"/dashboard",children:e.jsx(d,{children:"Back to Dashboard"})})]})]})}):e.jsxs("div",{className:"pt-32 pb-20 px-6 max-w-2xl mx-auto animate-fade-in",children:[e.jsxs(l,{to:`/order/${a}`,className:"inline-flex items-center gap-2 text-textMuted hover:text-textMain mb-6 transition-colors",children:[e.jsx(O,{size:16}),"Back to Order"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-textMain mb-2",children:"Request Refund"}),e.jsx("p",{className:"text-textMuted",children:"Tell us why you'd like a refund for this order"})]}),e.jsx("div",{className:"bg-surfaceHighlight border border-border rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-textMuted font-mono",children:n.order_number}),e.jsx("p",{className:"font-medium text-textMain",children:((j=n.listing)==null?void 0:j.title)||"Unknown Product"}),e.jsxs("p",{className:"text-xs text-textMuted mt-1",children:["Purchased on ",new Date(n.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-accent-primary",children:["â‚¹",n.price_amount]}),e.jsx("p",{className:"text-xs text-textMuted",children:"Refund Amount"})]})]})}),m&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-xl flex items-start gap-3",children:[e.jsx(x,{size:18,className:"text-red-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-400 text-sm",children:m})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-xs font-mono font-medium text-textSecondary uppercase tracking-wider",children:["Reason for Refund ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("div",{className:"space-y-2",children:S.map(s=>{const t=s.icon,i=r.reason===s.value;return e.jsxs("button",{type:"button",onClick:()=>b(q=>({...q,reason:s.value})),className:`w-full p-4 rounded-xl border text-left transition-all flex items-start gap-3 ${i?"bg-accent-primary/10 border-accent-primary/30 ring-1 ring-accent-primary/20":"bg-surfaceHighlight border-border hover:border-accent-primary/20"}`,children:[e.jsx(t,{size:20,className:i?"text-accent-primary":"text-textMuted"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${i?"text-accent-primary":"text-textMain"}`,children:s.label}),e.jsx("p",{className:"text-xs text-textMuted",children:s.description})]})]},s.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-xs font-mono font-medium text-textSecondary uppercase tracking-wider",children:["Detailed Explanation ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:r.description,onChange:s=>b(t=>({...t,description:s.target.value})),placeholder:"Please describe the issue in detail. Include specific examples, error messages, or screenshots links if applicable...",rows:5,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain placeholder:text-textMuted focus:border-accent-primary focus:outline-none resize-none",required:!0}),e.jsx("p",{className:"text-xs text-textMuted",children:"Minimum 50 characters. The more detail you provide, the faster we can process your request."})]}),e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl",children:e.jsxs("p",{className:"text-sm text-amber-400",children:[e.jsx("strong",{children:"Refund Policy:"})," Refunds are reviewed within 2-3 business days. Approved refunds will be processed to your original payment method. We may request additional information before processing."]})}),e.jsx(d,{type:"submit",disabled:u||!r.reason||r.description.length<50,className:"w-full",children:u?e.jsx(g,{size:18,className:"animate-spin"}):"Submit Refund Request"})]})]}):e.jsxs("div",{className:"pt-32 pb-20 px-6 min-h-[80vh] flex flex-col items-center justify-center text-center max-w-md mx-auto",children:[e.jsx(x,{size:48,className:"text-textMuted mb-6"}),e.jsx("h2",{className:"text-2xl font-display font-bold text-textMain mb-4",children:"Sign In Required"}),e.jsx("p",{className:"text-textSecondary mb-6",children:"You must be signed in to request a refund."}),e.jsx(d,{onClick:()=>N("/signin"),children:"Sign In"})]})};export{X as default};
