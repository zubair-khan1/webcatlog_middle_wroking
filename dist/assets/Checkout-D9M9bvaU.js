import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a,L as B,x as c,ax as A,ag as E,P as D,aP as T,d as q,a0 as F}from"./vendor-icons-BBHJ0ezg.js";import{b as H,B as m,s as u}from"./index-76QHltB_.js";import{e as I,d as O,u as R}from"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const K=()=>{var N;const{listingId:n}=I(),[_]=O(),l=R(),{user:d}=H(),[s,k]=a.useState(null),[w,P]=a.useState(!0),[h,g]=a.useState(!1),[b,o]=a.useState(null),[L,C]=a.useState(!1),r=_.get("license")||"standard",p=a.useMemo(()=>{if(!s)return 0;switch(r){case"buyout":return s.license_buyout_price||s.price;case"extended":return s.license_extended_price||s.price;case"standard":default:return s.license_standard_price||s.price}},[s,r]),f={standard:{name:"Standard License",description:"Launch, modify, and monetize"},extended:{name:"Extended License",description:"Fewer buyers, less competition"},buyout:{name:"Buyout License",description:"Exclusive ownership"}};a.useEffect(()=>{(async()=>{if(n)try{const{data:t,error:i}=await u.from("listings").select("*, creator:profiles!listings_creator_id_fkey(id, full_name, avatar_url)").eq("id",n).single();if(i)throw i;if(k(t),d){const{data:x}=await u.from("orders").select("id").eq("buyer_id",d.id).eq("listing_id",n).in("status",["paid","delivered","completed"]).maybeSingle();x&&C(!0)}}catch(t){console.error("Error fetching listing:",t),o("Failed to load checkout details")}finally{P(!1)}})()},[n,d]);const z=async()=>{var j;if(!(!s||!d)){g(!0),o(null);try{const i=p,x=i*.1,S=i-x,{data:y,error:v}=await u.from("orders").insert({buyer_id:d.id,seller_id:s.creator_id,listing_id:s.id,price_amount:i,commission_rate:.1,commission_amount:x,seller_amount:S,status:"paid",paid_at:new Date().toISOString(),license_type:r}).select().single();if(v)throw v;const{error:M}=await u.from("order_access").insert({order_id:y.id,source_files_url:s.source_files_url||null});if(M)throw M;l(`/payment-success/${y.id}`)}catch(t){console.error("Payment error:",t),(j=t.message)!=null&&j.includes("duplicate")?o("You have already purchased this blueprint"):o("Payment failed. Please try again.")}finally{g(!1)}}};return w?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(B,{className:"animate-spin text-accent-primary",size:32})}):s?L?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-6 text-center max-w-md mx-auto px-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-accent-primary/10 flex items-center justify-center",children:e.jsx(c,{className:"text-accent-primary",size:32})}),e.jsx("h2",{className:"text-2xl font-display font-bold text-textMain",children:"Already Purchased"}),e.jsx("p",{className:"text-textMuted",children:"You already own this blueprint. Access it from your orders."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(m,{variant:"outline",onClick:()=>l("/mvp-kits"),children:"Browse More"}),e.jsx(m,{onClick:()=>l("/dashboard"),children:"View Orders"})]})]}):e.jsx("div",{className:"min-h-screen bg-background py-12 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>l(`/listing/${n}`),className:"flex items-center gap-2 text-textMuted hover:text-textMain transition-colors mb-8",children:[e.jsx(A,{size:16}),"Back to Blueprint"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-textMain mb-2",children:"Checkout"}),e.jsx("p",{className:"text-textMuted",children:"Complete your purchase to get lifetime access"})]}),b&&e.jsxs("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[e.jsx(E,{size:18,className:"text-red-400 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-red-400 text-sm",children:b})]}),e.jsx("div",{className:"bg-surface border border-border rounded-xl p-6",children:e.jsxs("div",{className:"flex gap-4",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:s.title,className:"w-24 h-24 rounded-lg object-cover border border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-textMain mb-1",children:s.title}),s.tagline&&e.jsx("p",{className:"text-sm text-textMuted mb-2",children:s.tagline}),e.jsxs("p",{className:"text-xs text-textMuted",children:["by ",((N=s.creator)==null?void 0:N.full_name)||"Anonymous"]})]})]})}),e.jsxs("div",{className:"bg-surface border border-border rounded-xl p-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-textMain uppercase tracking-wider mb-4 flex items-center gap-2",children:[e.jsx(D,{size:16}),"What You'll Get"]}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-3 text-sm text-textMuted",children:[e.jsx(c,{size:16,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{children:"Full source code access"})]}),e.jsxs("li",{className:"flex items-start gap-3 text-sm text-textMuted",children:[e.jsx(c,{size:16,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{children:"Setup and deployment documentation"})]}),e.jsxs("li",{className:"flex items-start gap-3 text-sm text-textMuted",children:[e.jsx(c,{size:16,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{children:"Direct messaging with the creator"})]}),e.jsxs("li",{className:"flex items-start gap-3 text-sm text-textMuted",children:[e.jsx(c,{size:16,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{children:"Lifetime access and updates"})]}),e.jsxs("li",{className:"flex items-start gap-3 text-sm text-textMuted",children:[e.jsx(c,{size:16,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsx("span",{children:"Commercial usage rights"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface border border-border rounded-xl p-6",children:[e.jsx("h3",{className:"text-sm font-bold text-textMuted uppercase tracking-wider mb-4",children:"Order Summary"}),e.jsx("div",{className:"p-3 rounded-lg bg-surfaceHighlight border border-border mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{size:16,className:"text-accent-primary mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-textMain",children:f[r].name}),e.jsx("div",{className:"text-xs text-textMuted",children:f[r].description})]})]})}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-textMuted",children:f[r].name}),e.jsxs("span",{className:"text-textMain font-medium",children:["â‚¹",p]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-textMuted",children:"Platform Fee"}),e.jsx("span",{className:"text-textMain font-medium",children:"â‚¹0"})]}),e.jsxs("div",{className:"border-t border-border pt-3 flex justify-between",children:[e.jsx("span",{className:"font-bold text-textMain",children:"Total"}),e.jsxs("span",{className:"font-bold text-textMain text-lg",children:["â‚¹",p]})]})]}),e.jsx(m,{className:"w-full h-12 text-base font-semibold shadow-lg",onClick:z,isLoading:h,disabled:h,children:h?"Processing...":"Complete Purchase (Dev Mode)"}),e.jsx("div",{className:"mt-4 p-3 bg-accent-primary/5 rounded-lg border border-accent-primary/20",children:e.jsx("p",{className:"text-xs text-accent-primary font-medium",children:"ðŸ’³ Development Mode: This simulates a successful payment"})})]}),e.jsx("div",{className:"bg-surfaceHighlight/30 border border-border rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{size:18,className:"text-accent-tertiary shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-textMuted",children:[e.jsx("p",{className:"font-semibold text-textMain mb-1",children:"Secure Transaction"}),e.jsx("p",{children:"Your payment information is encrypted and secure. All purchases are protected by our buyer guarantee."})]})]})}),e.jsx("div",{className:"bg-surfaceHighlight/30 border border-border rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{size:18,className:"text-accent-primary shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-textMuted",children:[e.jsx("p",{className:"font-semibold text-textMain mb-1",children:"7-Day Money Back Guarantee"}),e.jsx("p",{children:"Not satisfied? Get a full refund within 7 days of purchase, no questions asked."})]})]})})]})]})]})}):e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4",children:[e.jsx("p",{className:"text-textMuted",children:"Blueprint not found"}),e.jsx(m,{onClick:()=>l("/mvp-kits"),children:"Browse Blueprints"})]})};export{K as default};
