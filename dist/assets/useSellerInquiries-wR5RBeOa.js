import{a as n}from"./vendor-icons-BBHJ0ezg.js";import{b as _,s as a}from"./index-76QHltB_.js";const S=()=>{const{user:r}=_(),[o,u]=n.useState([]),[q,s]=n.useState(!0),[m,c]=n.useState(null),l=n.useCallback(async()=>{if(!r){u([]),s(!1);return}s(!0),c(null);try{const{data:e,error:d}=await a.from("seller_inquiries").select(`
                    *,
                    listing:listings(id, title, image_url),
                    buyer:profiles!seller_inquiries_buyer_id_fkey(id, full_name, avatar_url, email)
                `).eq("seller_id",r.id).order("created_at",{ascending:!1});if(d)throw d;u(e||[])}catch(e){console.error("[useSellerInquiries] Error:",e),c(e instanceof Error?e.message:"Failed to fetch inquiries")}finally{s(!1)}},[r]);n.useEffect(()=>{if(l(),!r)return;const e=a.channel(`seller-inquiries:${r.id}`).on("postgres_changes",{event:"*",schema:"public",table:"seller_inquiries",filter:`seller_id=eq.${r.id}`},()=>{l()}).subscribe();return()=>{a.removeChannel(e)}},[r,l]);const f=o.filter(e=>e.status==="new").length;return{inquiries:o,isLoading:q,error:m,unreadCount:f,refetch:l}},p=()=>{const{user:r}=_(),[o,u]=n.useState(!1),[q,s]=n.useState(null);return{sendInquiry:async(c,l,f,e,d,g)=>{if(!r)return s("You must be logged in to send an inquiry"),!1;if(!e.trim()||!f.trim())return s("Subject and message are required"),!1;u(!0),s(null);try{const i={listing_id:c,seller_id:l,buyer_id:r.id,subject:f.trim(),message:e.trim(),status:"new"};let t;try{t=(await a.from("seller_inquiries").insert({...i,budget_range:d||null,timeline:g||null})).error,(t==null?void 0:t.code)==="42703"&&(t=(await a.from("seller_inquiries").insert(i)).error)}catch{t=(await a.from("seller_inquiries").insert(i)).error}if(t)throw t;return!0}catch(i){return console.error("[useSendInquiry] Error:",i),s(i instanceof Error?i.message:"Failed to send inquiry"),!1}finally{u(!1)}},isLoading:o,error:q}};export{S as a,p as u};
