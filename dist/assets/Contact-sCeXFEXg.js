import{j as e}from"./vendor-motion-Dl8lXUsH.js";import{a as d,aa as w,h as k,o as S,L as _}from"./vendor-icons-BBHJ0ezg.js";import{b as M,B as x,s as p}from"./index-76QHltB_.js";import{u as C}from"./useEmailAudience-CyQLlRDa.js";import"./vendor-react-Ojr5pEEK.js";import"./vendor-supabase-CIvuJI4W.js";import"./vendor-date-BvD7TL1z.js";const E={"Issue with a Purchase":"delivery_issue","Billing Question":"refund_request","Creator Inquiry":"clarification","Bug Report":"technical",Other:"other"},A=()=>{const{user:a,isAuthenticated:n}=M(),[N,m]=d.useState(!1),[l,h]=d.useState(null),[b,f]=d.useState(!1),[g,j]=d.useState(null),[t,y]=d.useState({firstName:"",lastName:"",email:"",subject:"Issue with a Purchase",message:""}),c=u=>{const{name:s,value:r}=u.target;y(i=>({...i,[s]:r}))},v=async u=>{u.preventDefault(),f(!0),j(null);try{const s={subject:`[Contact] ${t.subject}`,category:E[t.subject]||"other",source:"contact_us",involves_admin:!0,status:"open",priority:"normal"};n&&a?(s.created_by=a.id,s.buyer_id=a.id):(s.contact_email=t.email,s.contact_name=`${t.firstName} ${t.lastName}`.trim());const{data:r,error:i}=await p.from("tickets").insert(s).select("id, ticket_number").single();if(i){if(i.code==="42501"||i.message.includes("RLS")){const{error:o}=await p.from("contact_messages").insert({name:`${t.firstName} ${t.lastName}`.trim(),email:t.email,subject:t.subject,message:t.message,status:"unread"});if(o)throw o;m(!0);return}throw i}if(r){const o={ticket_id:r.id,content:`**From:** ${t.firstName} ${t.lastName}
**Email:** ${t.email}

${t.message}`,is_internal:!1,sender_role:"buyer",visibility:"all"};n&&a&&(o.sender_id=a.id),await p.from("ticket_messages").insert(o),h((r==null?void 0:r.ticket_number)||null)}m(!0),await C(t.email,"contact",{user_type:n?"buyer":"guest",consent_flag:!0,linked_user_id:a==null?void 0:a.id,metadata:{full_name:`${t.firstName} ${t.lastName}`.trim(),subject:t.subject}})}catch(s){console.error("Contact form error:",s),j(s instanceof Error?s.message:"Failed to send message. Please try again.")}finally{f(!1)}};return N?e.jsxs("div",{className:"pt-32 pb-20 px-6 min-h-[60vh] flex flex-col items-center justify-center animate-fade-in text-center max-w-md mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-accent-primary/20 text-accent-primary rounded-full flex items-center justify-center mb-6",children:e.jsx(w,{size:32})}),e.jsx("h2",{className:"text-3xl font-display font-bold text-textMain mb-4",children:l?"Ticket Created":"Message Sent"}),l&&e.jsxs("div",{className:"mb-4 px-4 py-2 bg-surface border border-border rounded-lg",children:[e.jsx("span",{className:"text-textMuted text-sm",children:"Ticket Number: "}),e.jsx("span",{className:"font-mono font-bold text-textMain",children:l})]}),e.jsx("p",{className:"text-textSecondary mb-8",children:l?"Your support ticket has been created. You can track its status in your dashboard.":"Thanks for reaching out. Our support team generally replies within 24 hours."}),n&&l&&e.jsx(x,{onClick:()=>window.location.href="/tickets",variant:"primary",className:"mb-3",children:"View My Tickets"}),e.jsx(x,{onClick:()=>{m(!1),h(null)},variant:"outline",children:"Send Another"})]}):e.jsx("div",{className:"pt-32 pb-20 px-6 max-w-5xl mx-auto min-h-screen",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12 lg:gap-20",children:[e.jsxs("div",{className:"animate-slide-up",children:[e.jsx("h1",{className:"text-4xl font-display font-bold text-textMain mb-6",children:"Contact Support"}),e.jsx("p",{className:"text-textSecondary text-lg mb-8 leading-relaxed",children:"Need help with a purchase? Found a bug in a kit? Or just want to partner with us? Fill out the form and we'll get back to you ASAP."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4 p-6 bg-surface border border-border rounded-xl",children:[e.jsx(k,{className:"text-accent-primary mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-textMain font-bold mb-1",children:"Product Support"}),e.jsx("p",{className:"text-textSecondary text-sm",children:"For questions about specific kits, please try messaging the creator directly from the listing page first."})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-6 bg-surface border border-border rounded-xl",children:[e.jsx(S,{className:"text-accent-primary mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-textMain font-bold mb-1",children:"Email Us"}),e.jsx("p",{className:"text-textSecondary text-sm",children:"khnnabubakar786@gmail.com"})]})]})]})]}),e.jsx("div",{className:"bg-surface border border-border rounded-2xl p-8 shadow-2xl animate-fade-in",children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-textMain uppercase",children:"First Name"}),e.jsx("input",{required:!0,type:"text",name:"firstName",value:t.firstName,onChange:c,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain focus:border-accent-primary focus:outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-textMain uppercase",children:"Last Name"}),e.jsx("input",{required:!0,type:"text",name:"lastName",value:t.lastName,onChange:c,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain focus:border-accent-primary focus:outline-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-textMain uppercase",children:"Email"}),e.jsx("input",{required:!0,type:"email",name:"email",value:t.email,onChange:c,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain focus:border-accent-primary focus:outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-textMain uppercase",children:"Subject"}),e.jsxs("select",{name:"subject",value:t.subject,onChange:c,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain focus:border-accent-primary focus:outline-none",children:[e.jsx("option",{children:"Issue with a Purchase"}),e.jsx("option",{children:"Billing Question"}),e.jsx("option",{children:"Creator Inquiry"}),e.jsx("option",{children:"Bug Report"}),e.jsx("option",{children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-textMain uppercase",children:"Message"}),e.jsx("textarea",{required:!0,rows:4,name:"message",value:t.message,onChange:c,className:"w-full bg-surfaceHighlight border border-border rounded-lg px-4 py-3 text-textMain focus:border-accent-primary focus:outline-none resize-none",placeholder:"Describe your issue..."})]}),g&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:e.jsx("p",{className:"text-red-400 text-sm",children:g})}),e.jsx(x,{type:"submit",size:"lg",className:"w-full",disabled:b,children:b?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_,{size:18,className:"animate-spin"}),"Sending..."]}):"Send Message"})]})})]})})};export{A as default};
